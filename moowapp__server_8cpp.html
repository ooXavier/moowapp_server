<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>mooWApp Server: /Volumes/OSX2/DEVz/C++/moowapp_server/src/moowapp_server.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mooWApp Server
   &#160;<span id="projectnumber">0.2.5</span>
   </div>
   <div id="projectbrief">WEBApp Statistics Server based on webservers access_log file (on top of BerkeleyDB and mongoose C embedded webserver)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('moowapp__server_8cpp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">moowapp_server.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Web Statistics DB Server aka : mooWApp.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;iostream&gt;</code><br/>
<code>#include &lt;string&gt;</code><br/>
<code>#include &lt;sstream&gt;</code><br/>
<code>#include &lt;fstream&gt;</code><br/>
<code>#include &lt;set&gt;</code><br/>
<code>#include &lt;vector&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;boost/progress.hpp&gt;</code><br/>
<code>#include &lt;boost/thread/thread.hpp&gt;</code><br/>
<code>#include &lt;boost/algorithm/string.hpp&gt;</code><br/>
<code>#include &lt;boost/date_time/posix_time/posix_time.hpp&gt;</code><br/>
<code>#include &lt;boost/date_time/gregorian/parsers.hpp&gt;</code><br/>
<code>#include &lt;boost/spirit/include/karma.hpp&gt;</code><br/>
<code>#include &lt;boost/interprocess/sync/scoped_lock.hpp&gt;</code><br/>
<code>#include &lt;boost/interprocess/sync/named_mutex.hpp&gt;</code><br/>
<code>#include &quot;<a class="el" href="global_8h_source.html">global.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="configuration_8h_source.html">configuration.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="db__access__berkeleydb_8h_source.html">db_access_berkeleydb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log__reader_8h_source.html">log_reader.h</a>&quot;</code><br/>
<code>#include &quot;mongoose.h&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structuri__config.html">uri_config</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object for each requests to handle by the web server.  <a href="structuri__config.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad48a67b36819981e659ad41993ddb0aa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ad48a67b36819981e659ad41993ddb0aa">getDBModules</a> (set&lt; string &gt; &amp;setModules, const string &amp;modulesLine)</td></tr>
<tr class="memdesc:ad48a67b36819981e659ad41993ddb0aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a set of web modules stored in DB.  <a href="#ad48a67b36819981e659ad41993ddb0aa"></a><br/></td></tr>
<tr class="separator:ad48a67b36819981e659ad41993ddb0aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae28a0ff255254d63ef7ffb8b0706385e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ae28a0ff255254d63ef7ffb8b0706385e">removeDBModules</a> (set&lt; string &gt; &amp;setDeleteModules)</td></tr>
<tr class="memdesc:ae28a0ff255254d63ef7ffb8b0706385e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove some modules from DB storage.  <a href="#ae28a0ff255254d63ef7ffb8b0706385e"></a><br/></td></tr>
<tr class="separator:ae28a0ff255254d63ef7ffb8b0706385e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa56b86725830f731d444c22087c2e311"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#aa56b86725830f731d444c22087c2e311">statsAddSumRow</a> (vector&lt; pair&lt; string, map&lt; int, int &gt; &gt; &gt; &amp;vRes, int nbResWithOffset, int offset)</td></tr>
<tr class="memdesc:aa56b86725830f731d444c22087c2e311"><td class="mdescLeft">&#160;</td><td class="mdescRight">Insert in front of the vector in param, a SUM of visits by days.  <a href="#aa56b86725830f731d444c22087c2e311"></a><br/></td></tr>
<tr class="separator:aa56b86725830f731d444c22087c2e311"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adea4946a81b35384695728029a83a0dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#adea4946a81b35384695728029a83a0dd">statsConstructResponse</a> (vector&lt; pair&lt; string, map&lt; int, int &gt; &gt; &gt; &amp;vRes, string &amp;response)</td></tr>
<tr class="memdesc:adea4946a81b35384695728029a83a0dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a JSON part string of the content of a vector of stats.  <a href="#adea4946a81b35384695728029a83a0dd"></a><br/></td></tr>
<tr class="separator:adea4946a81b35384695728029a83a0dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7004c82e3b4d1e9ef326ef311fca457"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ae7004c82e3b4d1e9ef326ef311fca457">convertDate</a> (const string &amp;strDate, const string &amp;format)</td></tr>
<tr class="separator:ae7004c82e3b4d1e9ef326ef311fca457"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4924d381b95b4b7c9f0127c6b34037ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a4924d381b95b4b7c9f0127c6b34037ff">get_qsvar</a> (const struct mg_request_info *ri, const char *name, char *dst, size_t dst_len)</td></tr>
<tr class="memdesc:a4924d381b95b4b7c9f0127c6b34037ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a value of particular form variable.  <a href="#a4924d381b95b4b7c9f0127c6b34037ff"></a><br/></td></tr>
<tr class="separator:a4924d381b95b4b7c9f0127c6b34037ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac069f2ec282dfc500cf692f6e2043b86"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ac069f2ec282dfc500cf692f6e2043b86">get_request_params</a> (struct mg_connection *conn, const struct mg_request_info *ri, map&lt; string, string &gt; &amp;mapParams)</td></tr>
<tr class="memdesc:ac069f2ec282dfc500cf692f6e2043b86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put all request parameters into a map.  <a href="#ac069f2ec282dfc500cf692f6e2043b86"></a><br/></td></tr>
<tr class="separator:ac069f2ec282dfc500cf692f6e2043b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7832c182316b3fcc10211ef3991495fa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a7832c182316b3fcc10211ef3991495fa">filteringPeriod</a> (struct mg_connection *conn, const struct mg_request_info *ri, int i, string &amp;strYearMonth, set&lt; string &gt; &amp;setDateToKeep, map&lt; string, string &gt; &amp;mapParams)</td></tr>
<tr class="memdesc:a7832c182316b3fcc10211ef3991495fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a set of web modules stored in DB.  <a href="#a7832c182316b3fcc10211ef3991495fa"></a><br/></td></tr>
<tr class="separator:a7832c182316b3fcc10211ef3991495fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af047c60e7efc61dfc7eef6be227115f2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#af047c60e7efc61dfc7eef6be227115f2">handle_jsonp</a> (struct mg_connection *conn, const struct mg_request_info *request_info)</td></tr>
<tr class="memdesc:af047c60e7efc61dfc7eef6be227115f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tell if the request is a JSON call.  <a href="#af047c60e7efc61dfc7eef6be227115f2"></a><br/></td></tr>
<tr class="separator:af047c60e7efc61dfc7eef6be227115f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a234ccd377859370d4d31388e5bd8c42a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a234ccd377859370d4d31388e5bd8c42a">stats_app_intra</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:a234ccd377859370d4d31388e5bd8c42a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP response for the /stats_app_intra context.  <a href="#a234ccd377859370d4d31388e5bd8c42a"></a><br/></td></tr>
<tr class="separator:a234ccd377859370d4d31388e5bd8c42a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac4ed184a623bf5d14ff73937f3a6dc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a1ac4ed184a623bf5d14ff73937f3a6dc">stats_app_day</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:a1ac4ed184a623bf5d14ff73937f3a6dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP response for the /stats_app_day context.  <a href="#a1ac4ed184a623bf5d14ff73937f3a6dc"></a><br/></td></tr>
<tr class="separator:a1ac4ed184a623bf5d14ff73937f3a6dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8e1ec95212b6c2d3ade16195e7776c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ab8e1ec95212b6c2d3ade16195e7776c2">stats_app_week</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:ab8e1ec95212b6c2d3ade16195e7776c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP response for the /stats_app_week context.  <a href="#ab8e1ec95212b6c2d3ade16195e7776c2"></a><br/></td></tr>
<tr class="separator:ab8e1ec95212b6c2d3ade16195e7776c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5556152ba0a32150017d67a4f36e11e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a5556152ba0a32150017d67a4f36e11e7">stats_app_month</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:a5556152ba0a32150017d67a4f36e11e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP response for the /stats_app_month context.  <a href="#a5556152ba0a32150017d67a4f36e11e7"></a><br/></td></tr>
<tr class="separator:a5556152ba0a32150017d67a4f36e11e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeafd35dda7b40821bfbe38c95e14450d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#aeafd35dda7b40821bfbe38c95e14450d">stats_modules_list</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:aeafd35dda7b40821bfbe38c95e14450d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP response for the /stats_modules_list context.  <a href="#aeafd35dda7b40821bfbe38c95e14450d"></a><br/></td></tr>
<tr class="separator:aeafd35dda7b40821bfbe38c95e14450d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adacfc03e97bb02d7804b33d7ea856827"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#adacfc03e97bb02d7804b33d7ea856827">stats_admin_list_mergemodules</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:adacfc03e97bb02d7804b33d7ea856827"><td class="mdescLeft">&#160;</td><td class="mdescRight">List modules marked as to be merged in the stats for the next vacation.  <a href="#adacfc03e97bb02d7804b33d7ea856827"></a><br/></td></tr>
<tr class="separator:adacfc03e97bb02d7804b33d7ea856827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a232515125378c667b5c246a39dad1c87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a232515125378c667b5c246a39dad1c87">stats_admin_do_mergemodules</a> (struct mg_connection *conn, const struct mg_request_info *ri)</td></tr>
<tr class="memdesc:a232515125378c667b5c246a39dad1c87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mark two modules to be merged in the stats for each days collected in the next vacation or do a full delete of a module.  <a href="#a232515125378c667b5c246a39dad1c87"></a><br/></td></tr>
<tr class="separator:a232515125378c667b5c246a39dad1c87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6085602e3defc3ac8098e7cac65bf36"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#af6085602e3defc3ac8098e7cac65bf36">get_error</a> (struct mg_connection *conn, const struct mg_request_info *request_info)</td></tr>
<tr class="memdesc:af6085602e3defc3ac8098e7cac65bf36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Build an HTTP error response.  <a href="#af6085602e3defc3ac8098e7cac65bf36"></a><br/></td></tr>
<tr class="separator:af6085602e3defc3ac8098e7cac65bf36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac195f8a341546265599265f82ecbd9e4"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ac195f8a341546265599265f82ecbd9e4">callback</a> (enum mg_event event, struct mg_connection *conn)</td></tr>
<tr class="separator:ac195f8a341546265599265f82ecbd9e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a907a7a377a38fab17176893fe802a0c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a907a7a377a38fab17176893fe802a0c6">compressionThread</a> ()</td></tr>
<tr class="separator:a907a7a377a38fab17176893fe802a0c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6daa6821aef23a8db23b630adeb0d778"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a6daa6821aef23a8db23b630adeb0d778">readLogThread</a> (const unsigned short logFileNb, unsigned long readPos)</td></tr>
<tr class="separator:a6daa6821aef23a8db23b630adeb0d778"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac75191349227c724e7ab524fa73926b8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ac75191349227c724e7ab524fa73926b8">handler_function</a> (int signum)</td></tr>
<tr class="memdesc:ac75191349227c724e7ab524fa73926b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler to close properly db and threads.  <a href="#ac75191349227c724e7ab524fa73926b8"></a><br/></td></tr>
<tr class="separator:ac75191349227c724e7ab524fa73926b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0ba51deb3be6dd78d799c654b3120e71"><td class="memItemLeft" align="right" valign="top">boost::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a0ba51deb3be6dd78d799c654b3120e71">mutex</a></td></tr>
<tr class="memdesc:a0ba51deb3be6dd78d799c654b3120e71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex for thread blocking.  <a href="#a0ba51deb3be6dd78d799c654b3120e71"></a><br/></td></tr>
<tr class="separator:a0ba51deb3be6dd78d799c654b3120e71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38412235d74c0d3479659a992f2ed736"><td class="memItemLeft" align="right" valign="top">struct mg_context *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#a38412235d74c0d3479659a992f2ed736">ctx</a></td></tr>
<tr class="memdesc:a38412235d74c0d3479659a992f2ed736"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer of request's context.  <a href="#a38412235d74c0d3479659a992f2ed736"></a><br/></td></tr>
<tr class="separator:a38412235d74c0d3479659a992f2ed736"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac746fa6ad48d19984a159f14bec028a3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#ac746fa6ad48d19984a159f14bec028a3">quit</a></td></tr>
<tr class="memdesc:ac746fa6ad48d19984a159f14bec028a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Boolean used to quit server properly.  <a href="#ac746fa6ad48d19984a159f14bec028a3"></a><br/></td></tr>
<tr class="separator:ac746fa6ad48d19984a159f14bec028a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed5e137ec2e4811f7584041b72a96e2d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structuri__config.html">uri_config</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="moowapp__server_8cpp.html#aed5e137ec2e4811f7584041b72a96e2d">uri_config</a> []</td></tr>
<tr class="separator:aed5e137ec2e4811f7584041b72a96e2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Web Statistics DB Server aka : mooWApp. </p>
<dl class="section author"><dt>Author</dt><dd>Xavier ETCHEBER </dd></dl>
<dl class="section version"><dt>Version</dt><dd>0.2.5 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ac195f8a341546265599265f82ecbd9e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* callback </td>
          <td>(</td>
          <td class="paramtype">enum mg_event&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a907a7a377a38fab17176893fe802a0c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void compressionThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Get config object</p>
<p>Get DB accessor</p>
<p>At the first start do a compression from the first day of the year</p>
<p>Hold the delay for non compressed stats</p>
<p>Specify a fixed time in the day : 03h00 the next day for the next compression of DB</p>
<p>New iteration check if current time &gt; parsing date fixed (= 03h00)</p>
<p>Compression to file atomically</p>
<p>Prepare for the next parsing : add +1 day to date fixed</p>
<p>Get current date</p>
<p>Reconstruct list of modules</p>
<p>Reloop thru all days since last parsing to j-x in order to remove details and store days only</p>
<p>produces "C: 2011-Nov-04", "C: 2011-Nov-05", ...</p>
<p>Check to see if this thread has been interrupted before going into each days of the curent month</p>
<p>Loop thru modules to compress stored stats</p>
<p>lineType=1 -&gt; URL with return code "200" lineType=2 -&gt; URL with return code "302" lineType=3 -&gt; URL with return code "404"</p>
<p>Delete the current Key in DB</p>
<p>Remove old 10 minutes stats</p>
<p>Delete the current Key in DB</p>
<p>Compress hours stats</p>
<p>Remove old hours stats</p>
<p>Delete the current Key in DB</p>
<p>SUM nb visit from hours to days</p>
<p>Add nb day visits in DB</p>
<p>Loop thru modules to delete to remove stored stats</p>
<p>lineType=1 -&gt; URL with return code "200" lineType=2 -&gt; URL with return code "302" lineType=3 -&gt; URL with return code "404"</p>
<p>Delete the current Key in DB</p>
<p>Flush changes to DB</p>
<p>DB compression</p>
<p>Release the mutex</p>
<p>Sleep for 20 minutes </p>

</div>
</div>
<a class="anchor" id="ae7004c82e3b4d1e9ef326ef311fca457"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">string convertDate </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>strDate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>format</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a7832c182316b3fcc10211ef3991495fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void filteringPeriod </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string &amp;&#160;</td>
          <td class="paramname"><em>strYearMonth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">set&lt; string &gt; &amp;&#160;</td>
          <td class="paramname"><em>setDateToKeep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; string, string &gt; &amp;&#160;</td>
          <td class="paramname"><em>mapParams</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a set of web modules stored in DB. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ri</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">strYearMonth</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">setDateToKeep</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">mapParams</td><td>A set to store the web modules names. </td></tr>
  </table>
  </dd>
</dl>
<p>Get periods for that project (filtering)</p>
<p>Store only date to be returned</p>
<p>Split sequences separated by coma ; Ex 1-4,6,8-12,15</p>
<p>Split sequences separated by - ; Ex: 3-30 </p>

</div>
</div>
<a class="anchor" id="af6085602e3defc3ac8098e7cac65bf36"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_error </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>request_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP error response. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4924d381b95b4b7c9f0127c6b34037ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_qsvar </td>
          <td>(</td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a value of particular form variable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>Variable name to decode from the buffer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst</td><td>Destination buffer for the decoded variable. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dst_len</td><td>Length of the destination buffer. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac069f2ec282dfc500cf692f6e2043b86"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_request_params </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">map&lt; string, string &gt; &amp;&#160;</td>
          <td class="paramname"><em>mapParams</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put all request parameters into a map. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ri</td><td>Information about HTTP request. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">mapParams</td><td>Length of the destination buffer. </td></tr>
  </table>
  </dd>
</dl>
<p>Read in two pieces, to test continuation</p>
<p>Split sequences separated by &amp; ; Ex var1=val1&amp;var2=val2</p>
<p>Split sequences separated by = ; Ex: var1=val1 </p>

</div>
</div>
<a class="anchor" id="ad48a67b36819981e659ad41993ddb0aa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int getDBModules </td>
          <td>(</td>
          <td class="paramtype">set&lt; string &gt; &amp;&#160;</td>
          <td class="paramname"><em>setModules</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>modulesLine</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a set of web modules stored in DB. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">c</td><td><a class="el" href="class_config.html" title="Configuration variables for the server.">Config</a> object containing the modules to be excluded </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">setModules</td><td>A set to store the web modules names. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">modulesLine</td><td>Key in DB to look for modules. </td></tr>
  </table>
  </dd>
</dl>
<p>Get DB accessor</p>
<p>Create a set of all known applications in DB</p>
<p>Exclude modules configuration </p>

</div>
</div>
<a class="anchor" id="af047c60e7efc61dfc7eef6be227115f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool handle_jsonp </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>request_info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tell if the request is a JSON call. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if "callback" param is present in query string, false otherwise. </dd></dl>

</div>
</div>
<a class="anchor" id="ac75191349227c724e7ab524fa73926b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handler_function </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>signum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler to close properly db and threads. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">signum</td><td>Signal to catch </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Announce yourself</p>
<p>Read configuration file</p>
<p>Get DB accessor</p>
<p>Open one database for each log file configured</p>
<p>Attach handler for SIGINT</p>
<p>DB Compact task set-up</p>
<p>Start reading file for each one configured</p>
<p>Json web server set-up</p>
<p>Wait until shutdown with SIGINT</p>
<p>Stop properly</p>
<p>DB Release </p>

</div>
</div>
<a class="anchor" id="a6daa6821aef23a8db23b630adeb0d778"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void readLogThread </td>
          <td>(</td>
          <td class="paramtype">const unsigned short&#160;</td>
          <td class="paramname"><em>logFileNb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>readPos</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read pos file for line number to start in log file</p>
<p>Get config object containing the path/name of file to read.</p>
<p>Get DB accessor</p>
<p>Get config informations, if fail exit</p>
<p>Loop</p>
<p>Write to file atomically</p>
<p>File ext format date :</p>
<p>Reconstruct list of modules</p>
<p>Save to pos file in case of error / server shutdown...</p>
<p>Update list of modules in DB</p>
<p>Released the mutex </p>

</div>
</div>
<a class="anchor" id="ae28a0ff255254d63ef7ffb8b0706385e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int removeDBModules </td>
          <td>(</td>
          <td class="paramtype">set&lt; string &gt; &amp;&#160;</td>
          <td class="paramname"><em>setDeleteModules</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove some modules from DB storage. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">setDeleteModules</td><td>A set of modules to be deleted from DB storage. </td></tr>
  </table>
  </dd>
</dl>
<p>Get DB accessor</p>
<p>Create a set of all known applications in DB</p>
<p>Remove "modules to be deleted" from modules set</p>
<p>Convert modules set to DB line </p>

</div>
</div>
<a class="anchor" id="a232515125378c667b5c246a39dad1c87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_admin_do_mergemodules </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mark two modules to be merged in the stats for each days collected in the next vacation or do a full delete of a module. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Get DB accessor</p>
<p>Construct response</p>
<p>Update list of deleted modules in DB</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Do use merge </dd></dl>
<p>Set begining JSON string in response.</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="adacfc03e97bb02d7804b33d7ea856827"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_admin_list_mergemodules </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>List modules marked as to be merged in the stats for the next vacation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Use me or delete me. Set begining JSON string in response. </dd></dl>
<p>Construct response</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="a1ac4ed184a623bf5d14ff73937f3a6dc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_app_day </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP response for the /stats_app_day context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Get DB accessor</p>
<p>Set begining JSON string in response.</p>
<p>Set Mode and Date in response.</p>
<p>Convert timestamp to Y-m-d</p>
<p>Build visits stats in response for each modules or app.</p>
<p>Get nb module of that app in request</p>
<p>Loop to put modules from request in a set</p>
<p>Remove this module from the whole app list</p>
<p>and each module in an app</p>
<p>Get nb visit from DB</p>
<p>Search Key (oss) in DB</p>
<p>Return nb visit</p>
<p>In all mode, add an "Others" application</p>
<p>Get nb visit from DB</p>
<p>Build Key ex: "application/w/1/2011-04-24/150";</p>
<p>Search Key (oss) in DB</p>
<p>Return nb visit</p>
<p>Add a SUM row serie</p>
<p>Construct response</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="a234ccd377859370d4d31388e5bd8c42a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_app_intra </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP response for the /stats_app_intra context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Get DB accessor</p>
<p>Set begining JSON string in response.</p>
<p>Set each date to according offset in response.</p>
<p>Set Mode and Date in response.</p>
<p>Build visits stats in response for each modules.</p>
<p>In all mode, add an "Others" application</p>
<p>Add a SUM row serie</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="a5556152ba0a32150017d67a4f36e11e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_app_month </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP response for the /stats_app_month context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Get DB accessor</p>
<p>Set begining JSON string in response.</p>
<p>Create a set for the Dates to loop easily</p>
<p>Save Year-Month for later</p>
<p>Set Mode and Date in response.</p>
<p>Build visits stats in response for each modules or app.</p>
<p>In all mode, add an "Others" application</p>
<p>Add a SUM row serie</p>
<p>Construct response</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="ab8e1ec95212b6c2d3ade16195e7776c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_app_week </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP response for the /stats_app_week context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Get DB accessor</p>
<p>Set begining JSON string in response.</p>
<p>Create a set for the Dates to loop easily</p>
<p>Save Year-Month for later</p>
<p>Set Mode and Date in response.</p>
<p>Build visits stats in response for each modules.</p>
<p>In all mode, add an "Others" application</p>
<p>if (nbVisitForApp != 0){</p>
<p>}</p>
<p>Add a SUM row serie</p>
<p>Construct response</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="aeafd35dda7b40821bfbe38c95e14450d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stats_modules_list </td>
          <td>(</td>
          <td class="paramtype">struct mg_connection *&#160;</td>
          <td class="paramname"><em>conn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct mg_request_info *&#160;</td>
          <td class="paramname"><em>ri</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Build an HTTP response for the /stats_modules_list context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">conn</td><td>Opaque connection handler. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">request_info</td><td>Information about HTTP request. </td></tr>
  </table>
  </dd>
</dl>
<p>Get parameters in request.</p>
<p>Check parameters values</p>
<p>Loop to remove modules from request of the set</p>
<p>Remove this module from the OTHERS list</p>
<p>Set begining JSON string in response.</p>
<p>Construct response</p>
<p>Set end JSON string in response. </p>

</div>
</div>
<a class="anchor" id="aa56b86725830f731d444c22087c2e311"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statsAddSumRow </td>
          <td>(</td>
          <td class="paramtype">vector&lt; pair&lt; string, map&lt; int, int &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vRes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nbResWithOffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Insert in front of the vector in param, a SUM of visits by days. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vRes</td><td>The vector where the SUM will be added. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nbResWithOffset</td><td>A number of days </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">offset</td><td>A number of stating day for the answer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="adea4946a81b35384695728029a83a0dd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void statsConstructResponse </td>
          <td>(</td>
          <td class="paramtype">vector&lt; pair&lt; string, map&lt; int, int &gt; &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>vRes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string &amp;&#160;</td>
          <td class="paramname"><em>response</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a JSON part string of the content of a vector of stats. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">vRes</td><td>The vector of all stats grouped by module and stored by day. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">response</td><td>Response string in JSON format (only part of JSON answer will be returned). Should by empty at call. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a38412235d74c0d3479659a992f2ed736"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct mg_context* ctx</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pointer of request's context. </p>

</div>
</div>
<a class="anchor" id="a0ba51deb3be6dd78d799c654b3120e71"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::mutex mutex</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mutex for thread blocking. </p>

</div>
</div>
<a class="anchor" id="ac746fa6ad48d19984a159f14bec028a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool quit</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Boolean used to quit server properly. </p>

</div>
</div>
<a class="anchor" id="aed5e137ec2e4811f7584041b72a96e2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structuri__config.html">uri_config</a>  <a class="el" href="structuri__config.html">uri_config</a>[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_app_intra&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#a234ccd377859370d4d31388e5bd8c42a" title="Build an HTTP response for the /stats_app_intra context.">stats_app_intra</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_app_day&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#a1ac4ed184a623bf5d14ff73937f3a6dc" title="Build an HTTP response for the /stats_app_day context.">stats_app_day</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_app_week&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#ab8e1ec95212b6c2d3ade16195e7776c2" title="Build an HTTP response for the /stats_app_week context.">stats_app_week</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_app_month&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#a5556152ba0a32150017d67a4f36e11e7" title="Build an HTTP response for the /stats_app_month context.">stats_app_month</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_modules_list&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#aeafd35dda7b40821bfbe38c95e14450d" title="Build an HTTP response for the /stats_modules_list context.">stats_modules_list</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_admin_do_mergemodules&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#a232515125378c667b5c246a39dad1c87" title="Mark two modules to be merged in the stats for each days collected in the next vacation or do a full ...">stats_admin_do_mergemodules</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/stats_admin_list_mergemodules&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#adacfc03e97bb02d7804b33d7ea856827" title="List modules marked as to be merged in the stats for the next vacation.">stats_admin_list_mergemodules</a>},</div>
<div class="line">  {MG_NEW_REQUEST, <span class="stringliteral">&quot;/&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#af6085602e3defc3ac8098e7cac65bf36" title="Build an HTTP error response.">get_error</a>},</div>
<div class="line">  {MG_HTTP_ERROR, <span class="stringliteral">&quot;&quot;</span>, &amp;<a class="code" href="moowapp__server_8cpp.html#af6085602e3defc3ac8098e7cac65bf36" title="Build an HTTP error response.">get_error</a>}</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="moowapp__server_8cpp.html">moowapp_server.cpp</a></li>
    <li class="footer">Generated on Tue Dec 11 2012 08:14:13 for mooWApp Server by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
